---
title: "Measuring the macroecological and local effects on plant-animal interaction using artificial fruits"
subtitle: 'Authors: '
author: "Supporting Information S3. Journal XXX"
format:
  pdf: 
    include-in-header:
      text: |
        \renewcommand{\thesection}{S\arabic{section}}
        \renewcommand{\thesubsection}{S\arabic{section}.\arabic{subsection}}
        \renewcommand{\thefigure}{S\arabic{figure}}
        \renewcommand{\thetable}{S\arabic{table}}
        \renewcommand{\thesection}{S\arabic{section}}
        \renewcommand{\thesubsection}{S\arabic{section}.\arabic{subsection}}
        \renewcommand{\thefigure}{S\arabic{figure}}
        \renewcommand{\thetable}{S\arabic{table}}
        \usepackage{fvextra}
        \DefineVerbatimEnvironment{Highlighting}{Verbatim}{
          fontsize=\footnotesize,
          baselinestretch=0.8,
          commandchars=\\\{\}  
        }
        \usepackage{xcolor} 
    toc: true
    toc-depth: 10
    number-sections: true
    colorlinks: true
    code-line-numbers: false
    code-font-size: small
number-sections: true
number-depth: 100
date-format: full 
date-modified: now
code-fold: false
code-overflow: scroll
code-line-numbers: true
code-copy: true
---

\pagebreak

# S1. Introduction

Bayesian hierarchical models assesing the causal effect of biogeographical, regional and landscape factors studied in *... et al. Measuring the macroecological and local effects on plant-animal interaction using artificial fruits*. This document includes minor data wrangling procedures for data preparation, mathematical notation of the models, models' sampling diagnostics, tables and figures of models' outputs.

# S2. `R` packages

```{r, results='hide', warning=FALSE, message=FALSE}

sapply(c('cmdstanr', 'readxl', 'magrittr', 'dplyr', 'ggplot2', 
         'tidyr', 'tibble', 'forcats', 'rethinking', 
         'cowplot', 'bayesplot', 'patchwork'), 
       library, character.only = T)

```


# S3. Data wrangling

```{r}
data <- readRDS('data.rds')

codes <- 
  lapply(data$codes, function(x) x[order(x$code), ])

d <- data$data
dis_matrix <- data$dist_islands

```


Proportion of `NA` observation per variable.

```{r}
sapply(d, function(x) mean(is.na(x)))

```

Indexing `NA` observations for conducting Bayesian imputation within the models. This code also includes minor formatting of index for other factors.

```{r}

dat <- d

for (i in c('lat', "human_pop", "human_footprint", "distance_mainland", 
            "island_size", "isolation", "altitude_m", "temperature", 
            "native_vegetation")) {
  dat[[i]] <- as.vector(scale(dat[[i]], center = T, scale = T))
}

# plant invasion rank 2.6%
dat$bush_cover[which(!is.na(d$bush_cover))] <- 
  as.vector(scale(dat$bush_cover[which(!is.na(d$bush_cover))]))

indx_na_bush <- which(is.na(d$bush_cover))
dat$bush_cover[indx_na_bush] <- 0

dat$plant_invasive_rank[which(!is.na(dat$plant_invasive_rank))] <- 
  dat$plant_invasive_rank[which(!is.na(dat$plant_invasive_rank))] + 1

dat$plant_invasive_rank[which(is.na(dat$plant_invasive_rank))] <- 4

predation <- dat$Arthropod + dat$Rodent
predation[which(dat$Unknown == 15)] <- 15
dat$predation <- predation
dat$dispersion <- dat$Lizard + dat$Bird
dat$rodent_all <- dat$Rodent
dat$rodent_all[which(dat$Unknown == 15)] <- 15

```

Final data set for fitting the models

```{r}
dat <- lapply(dat, FUN = function(x) if (is.factor(x)) as.numeric(x) else x)

names(dat)[1] <- 'country'

dat <- dat[-c(grep('season', names(dat)), 
              grep('correct_coord', names(dat)))]

dat$dist_island <- data$dist_islands
dat$N <- length(dat$country)
dat$N_type_island <- max(dat$island_type)
dat$N_country <- max(dat$country)
dat$N_island <- max(dat$island)
dat$N_realm <- max(dat$realm)
dat$N_ecoregion <- max(dat$ecoregion)
dat$N_biome <- max(dat$biome)
dat$N_grid <- max(dat$grid)
dat$N_plant <- max(dat$plant_ID)
dat$N_plant_invasive_rank <- max(dat$plant_invasive_rank)
dat$N_na_bush <- length(indx_na_bush)
dat$na_bush <- indx_na_bush
dat$Lizard <- ifelse(dat$Lizard > 0, 1, 0)
dat$Bird <- ifelse(dat$Bird > 0, 1, 0)
```

# S4. Custom functions

Functions for conducting sampling diagnostics

```{r}

source('functions_mod_diagnostics.r')

mod_diagnostics

```

The function `average_effect` uses the structure of the models to estimate the effect of factor variables

```{r}
average_effects <- function(n_levels, 
                            posterior,
                            x_var1,
                            x_var2, 
                            par1, 
                            par2) {
  
  y <- lapply(1:n_levels, FUN =
                function(i) {
                  
                  indx_xvar <- which(dat[[x_var1]] == i)
                  indx_xvar2 <- unique(dat[[x_var2]][indx_xvar])
                  indx_count <- unique(dat$country[indx_xvar])
                  indx_is <- unique(dat$island[indx_xvar])
                  indx_grid <- unique(dat$grid[indx_xvar])
                  indx_plant <- unique(dat$plant_ID[indx_xvar])
                  indx_ecoR <- unique(dat$ecoregion[indx_xvar])
                  indx_biome <- unique(dat$biome[indx_xvar])
                
                  est <-
                    with(posterior,
                         {
                           inv_logit(alpha[[1]] +
                                       posterior[[par1]][[i]] +
                                       apply(posterior[[par2]][, indx_xvar2],
                                             1, mean) +
                                       apply(p_island[, indx_is], 1, mean) +
                                       apply(p_country[, indx_count], 1, mean) +
                                       apply(p_grid[, indx_grid], 1, mean) +
                                       apply(p_plant[, indx_plant], 1, mean) +
                                       apply(p_ecoR[, indx_ecoR], 1, mean) +
                                       apply(p_biome[, indx_biome], 1, mean))
                         })
                  
                  tibble(y = est,
                         code = i,
                         x = x_var1)
                  
                })
  
  do.call('rbind', y)
  
}
```


The function `conditional effects` uses the structure of the model to graphic regression plots.

```{r}
cond_effects <- function(posterior, 
                         x_bar, 
                         slope, 
                         type = 'averaging', 
                         n = 100) {
  
  x_seq <- seq(min(x_bar), max(x_bar), length.out = n)
  
  type_is <- apply(posterior$TI, 1, mean)
  island <- apply(posterior$p_island, 1, mean)
  country <- apply(posterior$p_country, 1, mean)
  grid <- apply(posterior$p_grid, 1, mean)
  plant <- apply(posterior$p_plant, 1, mean)
  realm <- apply(posterior$p_realm, 1, mean)
  eco <- apply(posterior$p_ecoR, 1, mean)
  biome <- apply(posterior$p_biome, 1, mean)
  
  y <- lapply(seq_along(x_seq), FUN = 
                function(i) {
                  
                  x <- x_seq[i]
                  
                  est <- 
                    with(posterior, 
                         {
                           inv_logit(alpha[[1]] +
                                       beta[[slope]] * x +
                                       type_is +
                                       island +
                                       country +
                                       grid +
                                       plant +
                                       realm +
                                       eco +
                                       biome)
                         })
                  
                  if (type == 'averaging') {
                    tibble(x = x,
                           y = median(est),
                           li = quantile(est, 0.025),
                           ls = quantile(est, 0.975))

                  } else if (type == 'random') {

                    set.seed(23061993)
                    est <- sample(est, 100, replace = F)
                    pred <- rbinom(length(est), 15, est)
                    tibble(x = x,
                           y = median(pred),
                           li = quantile(pred, 0.025),
                           ls = quantile(pred, 0.975),
                           indx = i,
                           type = 'Predicted')

                  } else {

                    tibble(x = x,
                           y = est,
                           indx = i)
                  }
                  
                })
  
  do.call('rbind', y)
  
}
```

The function `slope_pars` extract median value, 95% credibility intervals, and probability of being above or below zero of slope parameters. This procdure is conducted for each response variable.

```{r}
slope_pars <- 
  function(posterior, 
           slope) {
    
    env <- ls(globalenv())

    post1 <- env[grep(posterior, env)]
    
    post <-
      lapply(post1, FUN =
             function(x) {
               p <- get(x)
               beta <- p$beta[[slope]]

               tibble(mu = median(beta),
                      li = quantile(beta, 0.025),
                      ls = quantile(beta, 0.975),
                      `P(beta > 0)` = mean(beta > 0),
                      `P(beta < 0)` = mean(beta < 0),
                      `Fruit consumption` = x)
             })

    post <- do.call('rbind', post)
    post$`Fruit consumption` <- 
      c('Bird frugivory', 'Seed dispersal', 
        'Lizard frugivory', 
        'Seed predation',
        'Total frugivory')
    post
  }
```

# S5. Models: Overall mathematical notation 

All models preserve the same structure with respect to random effects and correlated islands, but they differ in the adjustment set of predictors that should be included to detect the correct causal effect. Thus, we present the overall mathematical notation for all models here, whereas the specific adjustment sets for the models will be provided below. 

Prior probabilities were defined to encompass plausible values of the response variable on the $logit$ scale. $D$ stands for either $binomial$ or $bernoulli$ probability distributions. Dispersion parameters were parametrized to explore positive values, whereas prior probabilities of slope parameters of *causal effect* and *adjustment set* were defined to explore either positive or negative effects.


\pagebreak


$$
\begin{aligned}
& y_i \sim D(p_i) \\
& logit(p) = \alpha + \text{causal effect} + \text{adjustment set} + \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
& \\
& \alpha \sim \mathcal{N}(0, 1) \\
& \text{causal effect} \sim \mathcal{N}(0, 1) \\
& \text{adjustment set} \sim \mathcal{N}(0, 1) \\
& \\
& K_{ij} = \eta \times exp(-\rho \cdot D_{ij}^2) \\
& LK_{ij} = L_K \times L_K^T \\
& \tau = LK_{ij} \times Z_{\tau ~ island~id} \\
& \eta \sim exponential(4) \\
& \rho \sim exponential(1) \\
& Z_{\tau ~ island~id} \sim \mathcal{N}(0, 1) \\
&\\
& \mu_{\theta} \sim \mathcal{N}(0, 0.5) \\
& Z_\theta \sim \mathcal{N}(0, 1) \\
& \sigma_{\theta} \sim exponential(1) \\
& \theta = \mu_\theta + Z_\theta \times \sigma_\theta \\
\\
& \mu_{\phi} \sim \mathcal{N}(0, 0.5) \\
& Z_\phi \sim \mathcal{N}(0, 1) \\
& \sigma_{\phi} \sim exponential(1) \\
& \phi = \mu_\phi + Z_\phi \times \sigma_\phi \\
\\
& \mu_{\psi} \sim \mathcal{N}(0, 0.5) \\
& Z_\psi \sim \mathcal{N}(0, 1) \\
& \sigma_{\psi} \sim exponential(1) \\
& \psi = \mu_\psi + Z_\psi \times \sigma_\psi \\
\\
& \mu_{\delta} \sim \mathcal{N}(0, 0.5) \\
& Z_\delta \sim \mathcal{N}(0, 1) \\
& \sigma_{\delta} \sim exponential(1) \\
& \delta = \mu_\delta + Z_\delta \times \sigma_\delta \\
\\
& \mu_{\gamma} \sim \mathcal{N}(0, 0.5) \\
& Z_\gamma \sim \mathcal{N}(0, 1) \\
& \sigma_{\gamma} \sim exponential(1) \\
& \gamma = \mu_\gamma + Z_\gamma \times \sigma_\gamma \\
\end{aligned}
$$


# S6. Effect of Latitude

## Model: Total frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Total frugivory}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{latitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_latitude_tot.stan`.

```{r, echo=FALSE}
mod_latitude_tot <- readRDS('mod_latitude_tot.rds')
mod_latitude_tot$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_latitud_total.stan')
fit_latitude_tot <- cmdstan_model(file, compile = T)

mod_latitude_tot <- 
  fit_latitude_tot$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}
mcmc_trace(mod_latitude_tot$draws(c('alpha', 
                                     'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     # 'beta_I_isolation',
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                    'TI', 'p_realm', 
                                    'eta', 'rho')))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_latitude_tot <- mod_latitude_tot$summary()
mod_diagnostics(mod_latitude_tot, sum_latitude_tot)
ppcheck_latitude_tot <- mod_latitude_tot$draws('ppcheck', format = 'matrix')

plot(density(dat$total_remotion), main = '', 
     xlab = 'Total frugivory', ylim = c(0, 0.1))
for (i in 1:200) lines(density(ppcheck_latitude_tot[i, ]), lwd = 0.1)
lines(density(dat$total_remotion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_latitude_tot')
```

### Posterior distributions

```{r}
post_latitude_tot <- 
  mod_latitude_tot$draws(c('alpha', 
                       'beta_lat', 
                       # 'beta_H_pop', 
                       # 'beta_H_foot',
                       # 'beta_I_mainland', 
                       # 'beta_I_size',
                       # 'beta_I_alt', 
                       # 'beta_I_isolation',
                       # 'beta_temp', 
                       # 'beta_NV',
                       # 'beta_bush', 
                       # 'inv_rank', 
                       'TI', 'p_island', 
                       'p_country', 'p_grid', 
                       'p_plant', 'p_realm', 
                       'p_ecoR', 'p_biome'), 
                     format = 'df')

post_latitude_tot <- 
  lapply(c('alpha', 
           'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           # 'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_latitude_tot[, grep(x, colnames(post_latitude_tot))]
           })

names(post_latitude_tot) <- c('alpha', 
                          'beta', 
                          # 'beta_H_pop', 
                          # 'beta_H_foot',
                          # 'beta_I_mainland', 
                          # 'beta_I_size',
                          # 'beta_I_alt', 
                          # 'beta_I_isolation',
                          # 'beta_temp', 
                          # 'beta_NV',
                          # 'beta_bush', 
                          # 'inv_rank', 
                          'TI', 'p_island', 
                          'p_country', 'p_grid', 
                          'p_plant', 'p_realm', 
                          'p_ecoR', 'p_biome')
```



## Model: Bird frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Bird frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{latitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_latitude_bird.rds`.

```{r, echo=FALSE}
mod_latitude_bird <- readRDS('mod_latitude_bird.rds')
mod_latitude_bird$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_latitud_bird.stan')
fit_latitude_bird <- cmdstan_model(file, compile = T)

mod_latitude_bird <- 
  fit_latitude_bird$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 4e3,
    thin = 4, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_latitude_bird$draws(c('alpha', 
                                     'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     # 'beta_I_isolation',
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                     'TI', 'p_realm', 
                                     'eta', 'rho')))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_latitude_bird <- mod_latitude_bird$summary()
mod_diagnostics(mod_latitude_bird, sum_latitude_bird)
ppcheck_latitude_bird <- mod_latitude_bird$draws('ppcheck', format = 'matrix')

plot(density(dat$Bird), main = '', 
     xlab = 'Bird frugivory', ylim = c(0, 3))
for (i in 1:200) lines(density(ppcheck_latitude_bird[i, ]), lwd = 0.1)
lines(density(dat$Bird), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_latitude_bird')
```

### Posterior distributions

```{r}
post_latitude_bird <- 
  mod_latitude_bird$draws(c('alpha', 
                           'beta_lat', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_size',
                           # 'beta_I_alt', 
                           # 'beta_I_isolation',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome'), 
                         format = 'df')

post_latitude_bird <- 
  lapply(c('alpha', 
           'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           # 'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_latitude_bird[, grep(x, colnames(post_latitude_bird))]
           })

names(post_latitude_bird) <- c('alpha', 
                              'beta', 
                              # 'beta_H_pop', 
                              # 'beta_H_foot',
                              # 'beta_I_mainland', 
                              # 'beta_I_size',
                              # 'beta_I_alt', 
                              # 'beta_I_isolation',
                              # 'beta_temp', 
                              # 'beta_NV',
                              # 'beta_bush', 
                              # 'inv_rank', 
                              'TI', 'p_island', 
                              'p_country', 'p_grid', 
                              'p_plant', 'p_realm', 
                              'p_ecoR', 'p_biome')

```


## Model: Lizard frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Lizard frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{latitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_latitude_lizard.rds`.

```{r, echo=FALSE}
mod_latitude_lizard <- readRDS('mod_latitude_lizard.rds')
mod_latitude_lizard$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_latitud_lizard.stan')
fit_latitude_lizard <- cmdstan_model(file, compile = T)

mod_latitude_lizard <- 
  fit_latitude_lizard$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_latitude_lizard$draws(c('alpha', 
                                     'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     # 'beta_I_isolation',
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                     'TI', 'p_realm', 
                                     'eta', 'rho')))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_latitude_lizard <- mod_latitude_lizard$summary()
mod_diagnostics(mod_latitude_lizard, sum_latitude_lizard)
ppcheck_latitude_lizard <- mod_latitude_lizard$draws('ppcheck', format = 'matrix')

plot(density(dat$Lizard), main = '', 
     xlab = 'Lizard frugivory', ylim = c(0, 7))
for (i in 1:200) lines(density(ppcheck_latitude_lizard[i, ]), lwd = 0.1)
lines(density(dat$Lizard), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_latitude_lizard')
```

### Posterior distributions

```{r}
post_latitude_lizard <- 
  mod_latitude_lizard$draws(c('alpha', 
                            'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_size',
                            # 'beta_I_alt', 
                            # 'beta_I_isolation',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_latitude_lizard <- 
  lapply(c('alpha', 
           'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           # 'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_latitude_lizard[, grep(x, colnames(post_latitude_lizard))]
           })

names(post_latitude_lizard) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_size',
                               # 'beta_I_alt', 
                               # 'beta_I_isolation',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')
```


## Model: Fruit dispersal

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit dispersal}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{latitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_latitude_disp.rds`.

```{r, echo=FALSE}
mod_latitude_disp <- readRDS('mod_latitude_disp.rds')
mod_latitude_disp$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_latitud_dispersion.stan')
fit_latitude_disp <- cmdstan_model(file, compile = T)

mod_latitude_disp <- 
  fit_latitude_disp$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_latitude_disp$draws(c('alpha', 
                                     'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     # 'beta_I_isolation',
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                     'TI', 'p_realm', 
                                     'eta', 'rho')))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_latitude_disp <- mod_latitude_disp$summary()
mod_diagnostics(mod_latitude_disp, sum_latitude_disp)
ppcheck_latitude_disp <- mod_latitude_disp$draws('ppcheck', format = 'matrix')

plot(density(dat$dispersion), main = '', 
     xlab = 'Seed dispersal', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_latitude_disp[i, ]), lwd = 0.1)
lines(density(dat$dispersion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_latitude_disp')
```

### Posterior distributions

```{r}
post_latitude_disp <- 
  mod_latitude_disp$draws(c('alpha', 
                           'beta_lat', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_size',
                           # 'beta_I_alt', 
                           # 'beta_I_isolation',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome'), 
                         format = 'df')

post_latitude_disp <- 
  lapply(c('alpha', 
           'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           # 'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_latitude_disp[, grep(x, colnames(post_latitude_disp))]
           })

names(post_latitude_disp) <- c('alpha', 
                              'beta', 
                              # 'beta_H_pop', 
                              # 'beta_H_foot',
                              # 'beta_I_mainland', 
                              # 'beta_I_size',
                              # 'beta_I_alt', 
                              # 'beta_I_isolation',
                              # 'beta_temp', 
                              # 'beta_NV',
                              # 'beta_bush', 
                              # 'inv_rank', 
                              'TI', 'p_island', 
                              'p_country', 'p_grid', 
                              'p_plant', 'p_realm', 
                              'p_ecoR', 'p_biome')

```


## Model: Fruit predation

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit predation}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{latitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_latitude_pred.rds`.

```{r, echo=FALSE}
mod_latitude_pred <- readRDS('mod_latitude_pred.rds')
mod_latitude_pred$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_latitud_predation.stan')
fit_latitude_pred <- cmdstan_model(file, compile = T)

mod_latitude_pred <- 
  fit_latitude_pred$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_latitude_pred$draws(c('alpha', 
                                     'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     # 'beta_I_isolation',
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                     'TI', 'p_realm', 
                                     'eta', 'rho')))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_latitude_pred <- mod_latitude_pred$summary()
mod_diagnostics(mod_latitude_pred, sum_latitude_pred)

ppcheck_latitude_pred <- mod_latitude_pred$draws('ppcheck', format = 'matrix')

plot(density(dat$predation), main = '', 
     xlab = 'Seed predation', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_latitude_pred[i, ]), lwd = 0.1)
lines(density(dat$predation), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_latitude_pred')
```

### Posterior distributions

```{r}
post_latitude_pred <- 
  mod_latitude_pred$draws(c('alpha', 
                            'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_size',
                            # 'beta_I_alt', 
                            # 'beta_I_isolation',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_latitude_pred <- 
  lapply(c('alpha', 
           'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           # 'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_latitude_pred[, grep(x, colnames(post_latitude_pred))]
           })

names(post_latitude_pred) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_size',
                               # 'beta_I_alt', 
                               # 'beta_I_isolation',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')

```


# S7. Effect of island isoltion

## Model: Total frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Total frugivory}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island isolation}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_isolation_tot.rds`.

```{r, echo=FALSE}
mod_isolation_tot <- readRDS('mod_isolation_tot.rds')
mod_isolation_tot$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_isolation_total.stan')
fit_isolation_tot <- cmdstan_model(file, compile = T)

mod_isolation_tot <- 
  fit_isolation_tot$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}
mcmc_trace(mod_isolation_tot$draws(c('alpha', 
                                     #'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     'beta_I_isolation', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome', 
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                     )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_isolation_tot <- mod_isolation_tot$summary()
mod_diagnostics(mod_isolation_tot, sum_isolation_tot)
ppcheck_isolation_tot <- mod_isolation_tot$draws('ppcheck', format = 'matrix')

plot(density(dat$total_remotion), main = '', 
     xlab = 'Total frugivory', ylim = c(0, 0.1))
for (i in 1:200) lines(density(ppcheck_isolation_tot[i, ]), lwd = 0.1)
lines(density(dat$total_remotion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_isolation_tot')
```

### Posterior distributions

```{r}
post_isolation_tot <- 
  mod_isolation_tot$draws(c('alpha', 
                           #'beta_lat', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_size',
                           # 'beta_I_alt', 
                           'beta_I_isolation',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome'), 
                         format = 'df')

post_isolation_tot <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_isolation_tot[, grep(x, colnames(post_isolation_tot))]
           })

names(post_isolation_tot) <- c('alpha', 
                              'beta', 
                              # 'beta_H_pop', 
                              # 'beta_H_foot',
                              # 'beta_I_mainland', 
                              # 'beta_I_size',
                              # 'beta_I_alt', 
                              #'beta_I_isolation',
                              # 'beta_temp', 
                              # 'beta_NV',
                              # 'beta_bush', 
                              # 'inv_rank', 
                              'TI', 'p_island', 
                              'p_country', 'p_grid', 
                              'p_plant', 'p_realm', 
                              'p_ecoR', 'p_biome')
```



## Model: Bird frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Bird frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{island isolation}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_isolation_bird.rds`.

```{r, echo=FALSE}
mod_isolation_bird <- readRDS('mod_isolation_bird.rds')
mod_isolation_bird$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_isolation_bird.stan')
fit_isolation_bird <- cmdstan_model(file, compile = T)

mod_isolation_bird <- 
  fit_isolation_bird$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_isolation_bird$draws(c('alpha', 
                                     #'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     'beta_I_isolation', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_isolation_bird <- mod_isolation_bird$summary()
mod_diagnostics(mod_isolation_bird, sum_isolation_bird)
ppcheck_isolation_bird <- mod_isolation_bird$draws('ppcheck', format = 'matrix')

plot(density(dat$Bird), main = '', 
     xlab = 'Bird frugivory', ylim = c(0, 3))
for (i in 1:200) lines(density(ppcheck_isolation_bird[i, ]), lwd = 0.1)
lines(density(dat$Bird), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_isolation_bird')
```

### Posterior distributions

```{r}
post_isolation_bird <- 
  mod_isolation_bird$draws(c('alpha', 
                             # 'beta_lat', 
                             # 'beta_H_pop', 
                             # 'beta_H_foot',
                             # 'beta_I_mainland', 
                             # 'beta_I_size',
                             # 'beta_I_alt', 
                             'beta_I_isolation',
                             # 'beta_temp', 
                             # 'beta_NV',
                             # 'beta_bush', 
                             # 'inv_rank', 
                             'TI', 'p_island', 
                             'p_country', 'p_grid', 
                             'p_plant', 'p_realm', 
                             'p_ecoR', 'p_biome'), 
                           format = 'df')

post_isolation_bird <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_isolation_bird[, grep(x, colnames(post_isolation_bird))]
           })

names(post_isolation_bird) <- c('alpha', 
                                'beta', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                # 'beta_I_alt', 
                                # 'beta_I_isolation',
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                'TI', 'p_island', 
                                'p_country', 'p_grid', 
                                'p_plant', 'p_realm', 
                                'p_ecoR', 'p_biome')

```


## Model: Lizard frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Lizard frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{island isolation}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_isolation_lizard.rds`.

```{r, echo=FALSE}
mod_isolation_lizard <- readRDS('mod_isolation_lizard.rds')
mod_isolation_lizard$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_isolation_lizard.stan')
fit_isolation_lizard <- cmdstan_model(file, compile = T)

mod_isolation_lizard <- 
  fit_isolation_lizard$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_isolation_lizard$draws(c('alpha', 
                                     #'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     'beta_I_isolation', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_isolation_lizard <- mod_isolation_lizard$summary()
mod_diagnostics(mod_isolation_lizard, sum_isolation_lizard)
ppcheck_isolation_lizard <- mod_isolation_lizard$draws('ppcheck', format = 'matrix')

plot(density(dat$Lizard), main = '', 
     xlab = 'Lizard frugivory', ylim = c(0, 6))
for (i in 1:200) lines(density(ppcheck_isolation_lizard[i, ]), lwd = 0.1)
lines(density(dat$Lizard), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_isolation_lizard')
```

### Posterior distributions

```{r}
post_isolation_lizard <- 
  mod_isolation_lizard$draws(c('alpha', 
                             # 'beta_lat', 
                             # 'beta_H_pop', 
                             # 'beta_H_foot',
                             # 'beta_I_mainland', 
                             # 'beta_I_size',
                             # 'beta_I_alt', 
                             'beta_I_isolation',
                             # 'beta_temp', 
                             # 'beta_NV',
                             # 'beta_bush', 
                             # 'inv_rank', 
                             'TI', 'p_island', 
                             'p_country', 'p_grid', 
                             'p_plant', 'p_realm', 
                             'p_ecoR', 'p_biome'), 
                           format = 'df')

post_isolation_lizard <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_isolation_lizard[, grep(x, colnames(post_isolation_lizard))]
           })

names(post_isolation_lizard) <- c('alpha', 
                                'beta', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                # 'beta_I_alt', 
                                # 'beta_I_isolation',
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                'TI', 'p_island', 
                                'p_country', 'p_grid', 
                                'p_plant', 'p_realm', 
                                'p_ecoR', 'p_biome')
```


## Model: Fruit dispersal

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit dispersal}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island isolation}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_isolation_disp.rds`.

```{r, echo=FALSE}
mod_isolation_disp <- readRDS('mod_isolation_disp.rds')
mod_isolation_disp$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_isolation_dispersion.stan')
fit_isolation_disp <- cmdstan_model(file, compile = T)

mod_isolation_disp <- 
  fit_isolation_disp$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_isolation_disp$draws(c('alpha', 
                                     #'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     'beta_I_isolation', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_isolation_disp <- mod_isolation_disp$summary()
mod_diagnostics(mod_isolation_disp, sum_isolation_disp)
ppcheck_isolation_disp <- mod_isolation_disp$draws('ppcheck', format = 'matrix')

plot(density(dat$dispersion), main = '', 
     xlab = 'Seed dispersal', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_isolation_disp[i, ]), lwd = 0.1)
lines(density(dat$dispersion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_isolation_disp')
```

### Posterior distributions

```{r}
post_isolation_disp <- 
  mod_isolation_disp$draws(c('alpha', 
                            # 'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_size',
                            # 'beta_I_alt', 
                            'beta_I_isolation',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_isolation_disp <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_isolation_disp[, grep(x, colnames(post_isolation_disp))]
           })

names(post_isolation_disp) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_size',
                               # 'beta_I_alt', 
                               # 'beta_I_isolation',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')

```


## Model: Fruit predation

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit predation}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island isolation}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_isolation_pred.rds`.

```{r, echo=FALSE}
mod_isolation_pred <- readRDS('mod_isolation_pred.rds')
mod_isolation_pred$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_isolation_predation.stan')
fit_isolation_pred <- cmdstan_model(file, compile = T)

mod_isolation_pred <- 
  fit_isolation_pred$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_isolation_pred$draws(c('alpha', 
                                     #'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_size',
                                     # 'beta_I_alt', 
                                     'beta_I_isolation', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_isolation_pred <- mod_isolation_pred$summary()
mod_diagnostics(mod_isolation_pred, sum_isolation_pred)

ppcheck_isolation_pred <- mod_isolation_pred$draws('ppcheck', format = 'matrix')

plot(density(dat$predation), main = '', 
     xlab = 'Seed predation', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_isolation_pred[i, ]), lwd = 0.1)
lines(density(dat$predation), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_isolation_pred')
```

### Posterior distributions

```{r}
post_isolation_pred <- 
  mod_isolation_pred$draws(c('alpha', 
                            # 'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_size',
                            # 'beta_I_alt', 
                            'beta_I_isolation',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_isolation_pred <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_isolation',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_isolation_pred[, grep(x, colnames(post_isolation_pred))]
           })

names(post_isolation_pred) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_size',
                               # 'beta_I_alt', 
                               # 'beta_I_isolation',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')

```


# S8. Effect of island size

## Model: Total frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Total frugivory}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island size}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_size_tot.rds`.

```{r, echo=FALSE}
mod_size_tot <- readRDS('mod_size_tot.rds')
mod_size_tot$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_size_total.stan')
fit_size_tot <- cmdstan_model(file, compile = T)

mod_size_tot <- 
  fit_size_tot$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}
mcmc_trace(mod_size_tot$draws(c('alpha', 
                                #'beta_lat', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                # 'beta_I_alt', 
                                'beta_I_size', 
                                'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_size_tot <- mod_size_tot$summary()
mod_diagnostics(mod_size_tot, sum_size_tot)
ppcheck_size_tot <- mod_size_tot$draws('ppcheck', format = 'matrix')

plot(density(dat$total_remotion), main = '', 
     xlab = 'Total fruigivory', ylim = c(0, 0.1))
for (i in 1:200) lines(density(ppcheck_size_tot[i, ]), lwd = 0.1)
lines(density(dat$total_remotion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_size_tot')
```

### Posterior distributions

```{r}
post_size_tot <- 
  mod_size_tot$draws(c('alpha', 
                            #'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_size',
                            # 'beta_I_alt', 
                            'beta_I_size',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_size_tot <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_size',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_size_tot[, grep(x, colnames(post_size_tot))]
           })

names(post_size_tot) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_size',
                               # 'beta_I_alt', 
                               #'beta_I_size',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')
```



## Model: Bird frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Bird frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{island size}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_size_bird.rds`.

```{r, echo=FALSE}
mod_size_bird <- readRDS('mod_size_bird.rds')
mod_size_bird$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_size_bird.stan')
fit_size_bird <- cmdstan_model(file, compile = T)

mod_size_bird <- 
  fit_size_bird$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_size_bird$draws(c('alpha', 
                                #'beta_lat', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                # 'beta_I_alt', 
                                'beta_I_size', 
                                'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_size_bird <- mod_size_bird$summary()
mod_diagnostics(mod_size_bird, sum_size_bird)
ppcheck_size_bird <- mod_size_bird$draws('ppcheck', format = 'matrix')

plot(density(dat$Bird), main = '', 
     xlab = 'Bird frugivory', ylim = c(0, 3))
for (i in 1:200) lines(density(ppcheck_size_bird[i, ]), lwd = 0.1)
lines(density(dat$Bird), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_size_bird')
```

### Posterior distributions

```{r}
post_size_bird <- 
  mod_size_bird$draws(c('alpha', 
                        # 'beta_lat', 
                        # 'beta_H_pop', 
                        # 'beta_H_foot',
                        # 'beta_I_mainland', 
                        # 'beta_I_size',
                        # 'beta_I_alt', 
                        'beta_I_size',
                        # 'beta_temp', 
                        # 'beta_NV',
                        # 'beta_bush', 
                        # 'inv_rank', 
                        'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome'), 
                      format = 'df')

post_size_bird <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_size',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_size_bird[, grep(x, colnames(post_size_bird))]
           })

names(post_size_bird) <- c('alpha', 
                           'beta', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_size',
                           # 'beta_I_alt', 
                           # 'beta_I_size',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome')

```


## Model: Lizard frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Lizard frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{island size}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_size_lizard.rds`.

```{r, echo=FALSE}
mod_size_lizard <- readRDS('mod_size_lizard.rds')
mod_size_lizard$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_size_lizard.stan')
fit_size_lizard <- cmdstan_model(file, compile = T)

mod_size_lizard <- 
  fit_size_lizard$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_size_lizard$draws(c('alpha', 
                                #'beta_lat', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                # 'beta_I_alt', 
                                'beta_I_size', 
                                'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_size_lizard <- mod_size_lizard$summary()
mod_diagnostics(mod_size_lizard, sum_size_lizard)
ppcheck_size_lizard <- mod_size_lizard$draws('ppcheck', format = 'matrix')

plot(density(dat$Lizard), main = '', 
     xlab = 'Lizard frugivory', ylim = c(0, 6))
for (i in 1:200) lines(density(ppcheck_size_lizard[i, ]), lwd = 0.1)
lines(density(dat$Lizard), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_size_lizard')
```

### Posterior distributions

```{r}
post_size_lizard <- 
  mod_size_lizard$draws(c('alpha', 
                        # 'beta_lat', 
                        # 'beta_H_pop', 
                        # 'beta_H_foot',
                        # 'beta_I_mainland', 
                        # 'beta_I_size',
                        # 'beta_I_alt', 
                        'beta_I_size',
                        # 'beta_temp', 
                        # 'beta_NV',
                        # 'beta_bush', 
                        # 'inv_rank', 
                        'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome'), 
                      format = 'df')

post_size_lizard <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_size',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_size_lizard[, grep(x, colnames(post_size_lizard))]
           })

names(post_size_lizard) <- c('alpha', 
                           'beta', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_size',
                           # 'beta_I_alt', 
                           # 'beta_I_size',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome')
```


## Model: Fruit dispersal

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit dispersal}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island size}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_size_disp.rds`.

```{r, echo=FALSE}
mod_size_disp <- readRDS('mod_size_disp.rds')
mod_size_disp$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_size_dispersion.stan')
fit_size_disp <- cmdstan_model(file, compile = T)

mod_size_disp <- 
  fit_size_disp$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_size_tot$draws(c('alpha', 
                                #'beta_lat', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                # 'beta_I_alt', 
                                'beta_I_size', 
                                'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_size_disp <- mod_size_disp$summary()
mod_diagnostics(mod_size_disp, sum_size_disp)
ppcheck_size_disp <- mod_size_disp$draws('ppcheck', format = 'matrix')

plot(density(dat$dispersion), main = '', 
     xlab = 'Fruit dispersal', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_size_disp[i, ]), lwd = 0.1)
lines(density(dat$dispersion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_size_disp')
```

### Posterior distributions

```{r}
post_size_disp <- 
  mod_size_disp$draws(c('alpha', 
                             # 'beta_lat', 
                             # 'beta_H_pop', 
                             # 'beta_H_foot',
                             # 'beta_I_mainland', 
                             # 'beta_I_size',
                             # 'beta_I_alt', 
                             'beta_I_size',
                             # 'beta_temp', 
                             # 'beta_NV',
                             # 'beta_bush', 
                             # 'inv_rank', 
                             'TI', 'p_island', 
                             'p_country', 'p_grid', 
                             'p_plant', 'p_realm', 
                             'p_ecoR', 'p_biome'), 
                           format = 'df')

post_size_disp <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_size',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_size_disp[, grep(x, colnames(post_size_disp))]
           })

names(post_size_disp) <- c('alpha', 
                                'beta', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                # 'beta_I_alt', 
                                # 'beta_I_size',
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                'TI', 'p_island', 
                                'p_country', 'p_grid', 
                                'p_plant', 'p_realm', 
                                'p_ecoR', 'p_biome')

```


## Model: Fruit predation

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit predation}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island isolation}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_size_pred.rds`.

```{r, echo=FALSE}
mod_size_pred <- readRDS('mod_size_pred.rds')
mod_size_pred$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}

file <- paste0(getwd(), '/mod_size_predation.stan')
fit_size_pred <- cmdstan_model(file, compile = T)

mod_size_pred <- 
  fit_size_pred$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_size_pred$draws(c('alpha', 
                                #'beta_lat', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                # 'beta_I_alt', 
                                'beta_I_size', 
                                'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_size_pred <- mod_size_pred$summary()
mod_diagnostics(mod_size_pred, sum_size_pred)

ppcheck_size_pred <- mod_size_pred$draws('ppcheck', format = 'matrix')

plot(density(dat$predation), main = '', 
     xlab = 'Seed predation', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_size_pred[i, ]), lwd = 0.1)
lines(density(dat$predation), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_size_pred')
```

### Posterior distributions

```{r}
post_size_pred <- 
  mod_size_pred$draws(c('alpha', 
                             # 'beta_lat', 
                             # 'beta_H_pop', 
                             # 'beta_H_foot',
                             # 'beta_I_mainland', 
                             # 'beta_I_size',
                             # 'beta_I_alt', 
                             'beta_I_size',
                             # 'beta_temp', 
                             # 'beta_NV',
                             # 'beta_bush', 
                             # 'inv_rank', 
                             'TI', 'p_island', 
                             'p_country', 'p_grid', 
                             'p_plant', 'p_realm', 
                             'p_ecoR', 'p_biome'), 
                           format = 'df')

post_size_pred <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_size',
           # 'beta_I_alt', 
           'beta_I_size',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_size_pred[, grep(x, colnames(post_size_pred))]
           })

names(post_size_pred) <- c('alpha', 
                                'beta', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                # 'beta_I_alt', 
                                # 'beta_I_size',
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                'TI', 'p_island', 
                                'p_country', 'p_grid', 
                                'p_plant', 'p_realm', 
                                'p_ecoR', 'p_biome')

```


# S9. Effect of island altitude

## Model: Total frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Total frugivory}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island altitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_altitude_tot.rds`.

```{r, echo=FALSE}
mod_altitude_tot <- readRDS('mod_altitude_tot.rds')
mod_altitude_tot$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_altitude_total.stan')
fit_altitude_tot <- cmdstan_model(file, compile = T)

mod_altitude_tot <- 
  fit_altitude_tot$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}
mcmc_trace(mod_altitude_tot$draws(c('alpha', 
                                #'beta_lat', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                'beta_I_alt', 
                                'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                #'beta_I_size'
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_tot <- mod_altitude_tot$summary()
mod_diagnostics(mod_altitude_tot, sum_altitude_tot)
ppcheck_altitude_tot <- mod_altitude_tot$draws('ppcheck', format = 'matrix')

plot(density(dat$total_remotion), main = '', 
     xlab = 'Total fruigivory', ylim = c(0, 0.1))
for (i in 1:200) lines(density(ppcheck_altitude_tot[i, ]), lwd = 0.1)
lines(density(dat$total_remotion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_tot')
```

### Posterior distributions

```{r}
post_altitude_tot <- 
  mod_altitude_tot$draws(c('alpha', 
                       #'beta_lat', 
                       # 'beta_H_pop', 
                       # 'beta_H_foot',
                       # 'beta_I_mainland', 
                       # 'beta_I_altitude',
                       # 'beta_I_alt', 
                       'beta_I_alt',
                       # 'beta_temp', 
                       # 'beta_NV',
                       # 'beta_bush', 
                       # 'inv_rank', 
                       'TI', 'p_island', 
                       'p_country', 'p_grid', 
                       'p_plant', 'p_realm', 
                       'p_ecoR', 'p_biome'), 
                     format = 'df')

post_altitude_tot <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_tot[, grep(x, colnames(post_altitude_tot))]
           })

names(post_altitude_tot) <- c('alpha', 
                          'beta', 
                          # 'beta_H_pop', 
                          # 'beta_H_foot',
                          # 'beta_I_mainland', 
                          # 'beta_I_altitude',
                          # 'beta_I_alt', 
                          #'beta_I_altitude',
                          # 'beta_temp', 
                          # 'beta_NV',
                          # 'beta_bush', 
                          # 'inv_rank', 
                          'TI', 'p_island', 
                          'p_country', 'p_grid', 
                          'p_plant', 'p_realm', 
                          'p_ecoR', 'p_biome')
```



## Model: Bird frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Bird frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{island altitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_size_bird.rds`.

```{r, echo=FALSE}
mod_altitude_bird <- readRDS('mod_altitude_bird.rds')
mod_altitude_bird$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_altitude_bird.stan')
fit_altitude_bird <- cmdstan_model(file, compile = T)

mod_altitude_bird <- 
  fit_altitude_bird$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_altitude_bird$draws(c('alpha', 
                                     # 'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_altitude',
                                     # 'beta_I_alt', 
                                     'beta_I_alt', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_bird <- mod_altitude_bird$summary()
mod_diagnostics(mod_altitude_bird, sum_altitude_bird)
ppcheck_altitude_bird <- mod_altitude_bird$draws('ppcheck', format = 'matrix')

plot(density(dat$Bird), main = '', 
     xlab = 'Bird frugivory', ylim = c(0, 3))
for (i in 1:200) lines(density(ppcheck_altitude_bird[i, ]), lwd = 0.1)
lines(density(dat$Bird), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_bird')
```

### Posterior distributions

```{r}
post_altitude_bird <- 
  mod_altitude_bird$draws(c('alpha', 
                            # 'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_altitude',
                            # 'beta_I_alt', 
                            'beta_I_alt',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_altitude_bird <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_bird[, grep(x, colnames(post_altitude_bird))]
           })

names(post_altitude_bird) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_altitude',
                               # 'beta_I_alt', 
                               # 'beta_I_altitude',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')

```


## Model: Lizard frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Lizard frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{island altitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_altitude_lizard.rds`.

```{r, echo=FALSE}
mod_altitude_lizard <- readRDS('mod_altitude_lizard.rds')
mod_altitude_lizard$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_altitude_lizard.stan')
fit_altitude_lizard <- cmdstan_model(file, compile = T)

mod_altitude_lizard <- 
  fit_altitude_lizard$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_altitude_lizard$draws(c('alpha', 
                                     # 'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_altitude',
                                     # 'beta_I_alt', 
                                     'beta_I_alt', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_lizard <- mod_altitude_lizard$summary()
mod_diagnostics(mod_altitude_lizard, sum_altitude_lizard)
ppcheck_altitude_lizard <- mod_altitude_lizard$draws('ppcheck', format = 'matrix')

plot(density(dat$Lizard), main = '', 
     xlab = 'Lizard frugivory', ylim = c(0, 6))
for (i in 1:200) lines(density(ppcheck_altitude_lizard[i, ]), lwd = 0.1)
lines(density(dat$Lizard), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_lizard')
```

### Posterior distributions

```{r}
post_altitude_lizard <- 
  mod_altitude_lizard$draws(c('alpha', 
                            # 'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_altitude',
                            # 'beta_I_alt', 
                            'beta_I_alt',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_altitude_lizard <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_lizard[, grep(x, colnames(post_altitude_lizard))]
           })

names(post_altitude_lizard) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_altitude',
                               # 'beta_I_alt', 
                               # 'beta_I_altitude',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')
```


## Model: Fruit dispersal

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit dispersal}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island altitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_altitude_disp.rds`.

```{r, echo=FALSE}
mod_altitude_disp <- readRDS('mod_altitude_disp.rds')
mod_altitude_disp$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_altitude_dispersion.stan')
fit_altitude_disp <- cmdstan_model(file, compile = T)

mod_altitude_disp <- 
  fit_altitude_disp$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_altitude_disp$draws(c('alpha', 
                                     # 'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_altitude',
                                     # 'beta_I_alt', 
                                     'beta_I_alt', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                     )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_disp <- mod_altitude_disp$summary()
mod_diagnostics(mod_altitude_disp, sum_altitude_disp)
ppcheck_altitude_disp <- mod_altitude_disp$draws('ppcheck', format = 'matrix')

plot(density(dat$dispersion), main = '', 
     xlab = 'Fruit dispersal', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_altitude_disp[i, ]), lwd = 0.1)
lines(density(dat$dispersion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_disp')
```

### Posterior distributions

```{r}
post_altitude_disp <- 
  mod_altitude_disp$draws(c('alpha', 
                        # 'beta_lat', 
                        # 'beta_H_pop', 
                        # 'beta_H_foot',
                        # 'beta_I_mainland', 
                        # 'beta_I_altitude',
                        # 'beta_I_alt', 
                        'beta_I_alt',
                        # 'beta_temp', 
                        # 'beta_NV',
                        # 'beta_bush', 
                        # 'inv_rank', 
                        'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome'), 
                      format = 'df')

post_altitude_disp <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_disp[, grep(x, colnames(post_altitude_disp))]
           })

names(post_altitude_disp) <- c('alpha', 
                           'beta', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_altitude',
                           # 'beta_I_alt', 
                           # 'beta_I_altitude',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome')

```


## Model: Fruit predation

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit predation}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island isolation}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_altitude_pred.rds`.

```{r, echo=FALSE}
mod_altitude_pred <- readRDS('mod_altitude_pred.rds')
mod_altitude_pred$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}

file <- paste0(getwd(), '/mod_altitude_predation.stan')
fit_altitude_pred <- cmdstan_model(file, compile = T)

mod_altitude_pred <- 
  fit_altitude_pred$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_altitude_pred$draws(c('alpha', 
                                #'beta_lat', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                 'beta_I_alt', 
                                'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                #'beta_I_size'
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_pred <- mod_altitude_pred$summary()
mod_diagnostics(mod_altitude_pred, sum_altitude_pred)
ppcheck_altitude_pred <- mod_altitude_pred$draws('ppcheck', format = 'matrix')

plot(density(dat$predation), main = '', 
     xlab = 'Seed predation', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_altitude_pred[i, ]), lwd = 0.1)
lines(density(dat$predation), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_pred')
```

### Posterior distributions

```{r}
post_altitude_pred <- 
  mod_altitude_pred$draws(c('alpha', 
                        # 'beta_lat', 
                        # 'beta_H_pop', 
                        # 'beta_H_foot',
                        # 'beta_I_mainland', 
                        # 'beta_I_altitude',
                        # 'beta_I_alt', 
                        'beta_I_alt',
                        # 'beta_temp', 
                        # 'beta_NV',
                        # 'beta_bush', 
                        # 'inv_rank', 
                        'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome'), 
                      format = 'df')

post_altitude_pred <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_pred[, grep(x, colnames(post_altitude_pred))]
           })

names(post_altitude_pred) <- c('alpha', 
                           'beta', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_altitude',
                           # 'beta_I_alt', 
                           # 'beta_I_altitude',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome')

```


# S10. Effect of island altitude

## Model: Total frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Total frugivory}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island altitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_altitude_tot.rds`.

```{r, echo=FALSE}
mod_altitude_tot <- readRDS('mod_altitude_tot.rds')
mod_altitude_tot$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_altitude_total.stan')
fit_altitude_tot <- cmdstan_model(file, compile = T)

mod_altitude_tot <- 
  fit_altitude_tot$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}
mcmc_trace(mod_altitude_tot$draws(c('alpha', 
                                #'beta_lat', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                'beta_I_alt', 
                                'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                #'beta_I_size'
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_tot <- mod_altitude_tot$summary()
mod_diagnostics(mod_altitude_tot, sum_altitude_tot)
ppcheck_altitude_tot <- mod_altitude_tot$draws('ppcheck', format = 'matrix')

plot(density(dat$total_remotion), main = '', 
     xlab = 'Total fruigivory', ylim = c(0, 0.1))
for (i in 1:200) lines(density(ppcheck_altitude_tot[i, ]), lwd = 0.1)
lines(density(dat$total_remotion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_tot')
```

### Posterior distributions

```{r}
post_altitude_tot <- 
  mod_altitude_tot$draws(c('alpha', 
                       #'beta_lat', 
                       # 'beta_H_pop', 
                       # 'beta_H_foot',
                       # 'beta_I_mainland', 
                       # 'beta_I_altitude',
                       # 'beta_I_alt', 
                       'beta_I_alt',
                       # 'beta_temp', 
                       # 'beta_NV',
                       # 'beta_bush', 
                       # 'inv_rank', 
                       'TI', 'p_island', 
                       'p_country', 'p_grid', 
                       'p_plant', 'p_realm', 
                       'p_ecoR', 'p_biome'), 
                     format = 'df')

post_altitude_tot <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_tot[, grep(x, colnames(post_altitude_tot))]
           })

names(post_altitude_tot) <- c('alpha', 
                          'beta', 
                          # 'beta_H_pop', 
                          # 'beta_H_foot',
                          # 'beta_I_mainland', 
                          # 'beta_I_altitude',
                          # 'beta_I_alt', 
                          #'beta_I_altitude',
                          # 'beta_temp', 
                          # 'beta_NV',
                          # 'beta_bush', 
                          # 'inv_rank', 
                          'TI', 'p_island', 
                          'p_country', 'p_grid', 
                          'p_plant', 'p_realm', 
                          'p_ecoR', 'p_biome')
```



## Model: Bird frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Bird frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{island altitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_altitude_bird.rds`.

```{r, echo=FALSE}
mod_altitude_bird <- readRDS('mod_altitude_bird.rds')
mod_altitude_bird$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_altitude_bird.stan')
fit_altitude_bird <- cmdstan_model(file, compile = T)

mod_altitude_bird <- 
  fit_altitude_bird$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_altitude_bird$draws(c('alpha', 
                                     # 'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_altitude',
                                     # 'beta_I_alt', 
                                     'beta_I_alt', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_bird <- mod_altitude_bird$summary()
mod_diagnostics(mod_altitude_bird, sum_altitude_bird)
ppcheck_altitude_bird <- mod_altitude_bird$draws('ppcheck', format = 'matrix')

plot(density(dat$Bird), main = '', 
     xlab = 'Bird frugivory', ylim = c(0, 3))
for (i in 1:200) lines(density(ppcheck_altitude_bird[i, ]), lwd = 0.1)
lines(density(dat$Bird), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_bird')
```

### Posterior distributions

```{r}
post_altitude_bird <- 
  mod_altitude_bird$draws(c('alpha', 
                            # 'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_altitude',
                            # 'beta_I_alt', 
                            'beta_I_alt',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_altitude_bird <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_bird[, grep(x, colnames(post_altitude_bird))]
           })

names(post_altitude_bird) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_altitude',
                               # 'beta_I_alt', 
                               # 'beta_I_altitude',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')

```


## Model: Lizard frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Lizard frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{island altitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_altitude_lizard.rds`.

```{r, echo=FALSE}
mod_altitude_lizard <- readRDS('mod_altitude_lizard.rds')
mod_altitude_lizard$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_altitude_lizard.stan')
fit_altitude_lizard <- cmdstan_model(file, compile = T)

mod_altitude_lizard <- 
  fit_altitude_lizard$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_altitude_lizard$draws(c('alpha', 
                                     # 'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_altitude',
                                     # 'beta_I_alt', 
                                     'beta_I_alt', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_lizard <- mod_altitude_lizard$summary()
mod_diagnostics(mod_altitude_lizard, sum_altitude_lizard)
ppcheck_altitude_lizard <- mod_altitude_lizard$draws('ppcheck', format = 'matrix')

plot(density(dat$Lizard), main = '', 
     xlab = 'Lizard frugivory', ylim = c(0, 6))
for (i in 1:200) lines(density(ppcheck_altitude_lizard[i, ]), lwd = 0.1)
lines(density(dat$Lizard), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_lizard')
```

### Posterior distributions

```{r}
post_altitude_lizard <- 
  mod_altitude_lizard$draws(c('alpha', 
                            # 'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_altitude',
                            # 'beta_I_alt', 
                            'beta_I_alt',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_altitude_lizard <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_lizard[, grep(x, colnames(post_altitude_lizard))]
           })

names(post_altitude_lizard) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_altitude',
                               # 'beta_I_alt', 
                               # 'beta_I_altitude',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')
```


## Model: Fruit dispersal

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit dispersal}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island altitude}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_altitude_disp.rds`.

```{r, echo=FALSE}
mod_altitude_disp <- readRDS('mod_altitude_disp.rds')
mod_altitude_disp$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_altitude_dispersion.stan')
fit_altitude_disp <- cmdstan_model(file, compile = T)

mod_altitude_disp <- 
  fit_altitude_disp$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_altitude_disp$draws(c('alpha', 
                                     # 'beta_lat', 
                                     # 'beta_H_pop', 
                                     # 'beta_H_foot',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_altitude',
                                     # 'beta_I_alt', 
                                     'beta_I_alt', 
                                     'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                     )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_disp <- mod_altitude_disp$summary()
mod_diagnostics(mod_altitude_disp, sum_altitude_disp)
ppcheck_altitude_disp <- mod_altitude_disp$draws('ppcheck', format = 'matrix')

plot(density(dat$dispersion), main = '', 
     xlab = 'Fruit dispersal', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_altitude_disp[i, ]), lwd = 0.1)
lines(density(dat$dispersion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_disp')
```

### Posterior distributions

```{r}
post_altitude_disp <- 
  mod_altitude_disp$draws(c('alpha', 
                        # 'beta_lat', 
                        # 'beta_H_pop', 
                        # 'beta_H_foot',
                        # 'beta_I_mainland', 
                        # 'beta_I_altitude',
                        # 'beta_I_alt', 
                        'beta_I_alt',
                        # 'beta_temp', 
                        # 'beta_NV',
                        # 'beta_bush', 
                        # 'inv_rank', 
                        'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome'), 
                      format = 'df')

post_altitude_disp <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_disp[, grep(x, colnames(post_altitude_disp))]
           })

names(post_altitude_disp) <- c('alpha', 
                           'beta', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_altitude',
                           # 'beta_I_alt', 
                           # 'beta_I_altitude',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome')

```


## Model: Fruit predation

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit predation}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{island isolation}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_altitude_pred.rds`.

```{r, echo=FALSE}
mod_altitude_pred <- readRDS('mod_altitude_pred.rds')
mod_altitude_pred$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}

file <- paste0(getwd(), '/mod_altitude_predation.stan')
fit_altitude_pred <- cmdstan_model(file, compile = T)

mod_altitude_pred <- 
  fit_altitude_pred$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_altitude_pred$draws(c('alpha', 
                                #'beta_lat', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_size',
                                 'beta_I_alt' , 
                                'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome',
                               'eta', 'rho'
                                #'beta_I_size'
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_altitude_pred <- mod_altitude_pred$summary()
mod_diagnostics(mod_altitude_pred, sum_altitude_pred)
ppcheck_altitude_pred <- mod_altitude_pred$draws('ppcheck', format = 'matrix')

plot(density(dat$predation), main = '', 
     xlab = 'Seed predation', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_altitude_pred[i, ]), lwd = 0.1)
lines(density(dat$predation), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_altitude_pred')
```

### Posterior distributions

```{r}
post_altitude_pred <- 
  mod_altitude_pred$draws(c('alpha', 
                        # 'beta_lat', 
                        # 'beta_H_pop', 
                        # 'beta_H_foot',
                        # 'beta_I_mainland', 
                        # 'beta_I_altitude',
                        # 'beta_I_alt', 
                        'beta_I_alt',
                        # 'beta_temp', 
                        # 'beta_NV',
                        # 'beta_bush', 
                        # 'inv_rank', 
                        'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome'), 
                      format = 'df')

post_altitude_pred <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_altitude',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_altitude_pred[, grep(x, colnames(post_altitude_pred))]
           })

names(post_altitude_pred) <- c('alpha', 
                           'beta', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_altitude',
                           # 'beta_I_alt', 
                           # 'beta_I_altitude',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome')

```


# S11. Effect of human footprint

## Model: Total frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Total frugivory}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{human footprint}_i + \beta \times \text{human population}_i + \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_footprint_tot.rds`.

```{r, echo=FALSE}
mod_footprint_tot <- readRDS('mod_footprint_tot.rds')
mod_footprint_tot$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_footprint_total.stan')
fit_footprint_tot <- cmdstan_model(file, compile = T)

mod_footprint_tot <- 
  fit_footprint_tot$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}
mcmc_trace(mod_footprint_tot$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        'beta_H_foot',
                                        'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome',
                           'eta', 'rho'
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        # 'beta_NV',
                                        # 'beta_bush', 
                                        # 'inv_rank', 
                                        )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_footprint_tot <- mod_footprint_tot$summary()
mod_diagnostics(mod_footprint_tot, sum_footprint_tot)
ppcheck_footprint_tot <- mod_footprint_tot$draws('ppcheck', format = 'matrix')

plot(density(dat$total_remotion), main = '', 
     xlab = 'Total fruigivory', ylim = c(0, 0.1))
for (i in 1:200) lines(density(ppcheck_footprint_tot[i, ]), lwd = 0.1)
lines(density(dat$total_remotion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_footprint_tot')
```

### Posterior distributions

```{r}
post_footprint_tot <- 
  mod_footprint_tot$draws(c('alpha', 
                           #'beta_lat', 
                           # 'beta_H_pop', 
                           'beta_H_foot',
                           # 'beta_I_mainland', 
                           #'beta_I_footprint',
                           # 'beta_I_alt', 
                           #'beta_I_alt',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome'), 
                         format = 'df')

post_footprint_tot <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_footprint',
           # 'beta_I_alt', 
           'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_footprint_tot[, grep(x, colnames(post_footprint_tot))]
           })

names(post_footprint_tot) <- c('alpha', 
                              'beta', 
                              # 'beta_H_pop', 
                              # 'beta_H_foot',
                              # 'beta_I_mainland', 
                              # 'beta_I_footprint',
                              # 'beta_I_alt', 
                              #'beta_I_footprint',
                              # 'beta_temp', 
                              # 'beta_NV',
                              # 'beta_bush', 
                              # 'inv_rank', 
                              'TI', 'p_island', 
                              'p_country', 'p_grid', 
                              'p_plant', 'p_realm', 
                              'p_ecoR', 'p_biome')
```



## Model: Bird frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Bird frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{human footprint}_i + \beta \times \text{human population}_i + \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_footprint_bird.rds`.

```{r, echo=FALSE}
mod_footprint_bird <- readRDS('mod_footprint_bird.rds')
mod_footprint_bird$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_footprint_bird.stan')
fit_footprint_bird <- cmdstan_model(file, compile = T)

mod_footprint_bird <- 
  fit_footprint_bird$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_footprint_bird$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        'beta_H_foot',
                                      'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome',
                            'eta', 'rho'
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        # 'beta_NV',
                                        # 'beta_bush', 
                                        # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_footprint_bird <- mod_footprint_bird$summary()
mod_diagnostics(mod_footprint_bird, sum_footprint_bird)
ppcheck_footprint_bird <- mod_footprint_bird$draws('ppcheck', format = 'matrix')

plot(density(dat$Bird), main = '', 
     xlab = 'Bird frugivory', ylim = c(0, 3))
for (i in 1:200) lines(density(ppcheck_footprint_bird[i, ]), lwd = 0.1)
lines(density(dat$Bird), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_footprint_bird')
```

### Posterior distributions

```{r}
post_footprint_bird <- 
  mod_footprint_bird$draws(c('alpha', 
                             # 'beta_lat', 
                             # 'beta_H_pop', 
                             'beta_H_foot',
                             # 'beta_I_mainland', 
                             # 'beta_I_footprint',
                             # 'beta_I_alt', 
                             # 'beta_I_alt',
                             # 'beta_temp', 
                             # 'beta_NV',
                             # 'beta_bush', 
                             # 'inv_rank', 
                             'TI', 'p_island', 
                             'p_country', 'p_grid', 
                             'p_plant', 'p_realm', 
                             'p_ecoR', 'p_biome'), 
                           format = 'df')

post_footprint_bird <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_footprint',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_footprint_bird[, grep(x, colnames(post_footprint_bird))]
           })

names(post_footprint_bird) <- c('alpha', 
                                'beta', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_footprint',
                                # 'beta_I_alt', 
                                # 'beta_I_footprint',
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                'TI', 'p_island', 
                                'p_country', 'p_grid', 
                                'p_plant', 'p_realm', 
                                'p_ecoR', 'p_biome')

```


## Model: Lizard frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Lizard frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{human footprint}_i + \beta \times \text{human population}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_footprint_lizard.rds`.

```{r, echo=FALSE}
mod_footprint_lizard <- readRDS('mod_footprint_lizard.rds')
mod_footprint_lizard$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_footprint_lizard.stan')
fit_footprint_lizard <- cmdstan_model(file, compile = T)

mod_footprint_lizard <- 
  fit_footprint_lizard$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_footprint_lizard$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        'beta_H_foot',
                                        'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome',
                            'eta', 'rho'
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        # 'beta_NV',
                                        # 'beta_bush', 
                                        # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_footprint_lizard <- mod_footprint_lizard$summary()
mod_diagnostics(mod_footprint_lizard, sum_footprint_lizard)
ppcheck_footprint_lizard <- mod_footprint_lizard$draws('ppcheck', format = 'matrix')

plot(density(dat$Lizard), main = '', 
     xlab = 'Lizard frugivory', ylim = c(0, 6))
for (i in 1:200) lines(density(ppcheck_footprint_lizard[i, ]), lwd = 0.1)
lines(density(dat$Lizard), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_footprint_lizard')
```

### Posterior distributions

```{r}
post_footprint_lizard <- 
  mod_footprint_lizard$draws(c('alpha', 
                             # 'beta_lat', 
                             # 'beta_H_pop', 
                             'beta_H_foot',
                             # 'beta_I_mainland', 
                             # 'beta_I_footprint',
                             # 'beta_I_alt', 
                             # 'beta_I_alt',
                             # 'beta_temp', 
                             # 'beta_NV',
                             # 'beta_bush', 
                             # 'inv_rank', 
                             'TI', 'p_island', 
                             'p_country', 'p_grid', 
                             'p_plant', 'p_realm', 
                             'p_ecoR', 'p_biome'), 
                           format = 'df')

post_footprint_lizard <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_footprint',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_footprint_lizard[, grep(x, colnames(post_footprint_lizard))]
           })

names(post_footprint_lizard) <- c('alpha', 
                                'beta', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_footprint',
                                # 'beta_I_alt', 
                                # 'beta_I_footprint',
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                'TI', 'p_island', 
                                'p_country', 'p_grid', 
                                'p_plant', 'p_realm', 
                                'p_ecoR', 'p_biome')
```


## Model: Fruit dispersal

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit dispersal}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{human footprint}_i + \beta \times \text{human population}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_footprint_disp.rds`.

```{r, echo=FALSE}
mod_footprint_disp <- readRDS('mod_footprint_disp.rds')
mod_footprint_disp$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_footprint_dispersion.stan')
fit_footprint_disp <- cmdstan_model(file, compile = T)

mod_footprint_disp <- 
  fit_footprint_disp$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_footprint_disp$draws(c('alpha', 
                                     # 'beta_lat', 
                                     # 'beta_H_pop', 
                                      'beta_H_foot',
                                     'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome',
                        'eta', 'rho'
                                     # 'beta_I_mainland', 
                                     # 'beta_I_altitude',
                                     # 'beta_I_alt', 
                                     #'beta_I_alt'
                                     # 'beta_temp', 
                                     # 'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                     )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_footprint_disp <- mod_footprint_disp$summary()
mod_diagnostics(mod_footprint_disp, sum_footprint_disp)
ppcheck_footprint_disp <- mod_footprint_disp$draws('ppcheck', format = 'matrix')


plot(density(dat$dispersion), main = '', 
     xlab = 'Fruit dispersal', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_footprint_disp[i, ]), lwd = 0.1)
lines(density(dat$dispersion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_footprint_disp')
```

### Posterior distributions

```{r}
post_footprint_disp <- 
  mod_footprint_disp$draws(c('alpha', 
                            # 'beta_lat', 
                            # 'beta_H_pop', 
                            'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_footprint',
                            # 'beta_I_alt', 
                            # 'beta_I_alt',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_footprint_disp <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_footprint',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_footprint_disp[, grep(x, colnames(post_footprint_disp))]
           })

names(post_footprint_disp) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_footprint',
                               # 'beta_I_alt', 
                               # 'beta_I_footprint',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')

```


## Model: Fruit predation

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit predation}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{human footprint}_i + \beta \times \text{human population}_i +  \\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_footprint_pred.rds`.

```{r, echo=FALSE}
mod_footprint_pred <- readRDS('mod_footprint_pred.rds')
mod_footprint_pred$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}

file <- paste0(getwd(), '/mod_footprint_predation.stan')
fit_footprint_pred <- cmdstan_model(file, compile = T)

mod_footprint_pred <- 
  fit_footprint_pred$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_footprint_pred$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        'beta_H_foot',
                                      'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome',
                        'eta', 'rho'
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        # 'beta_NV',
                                        # 'beta_bush', 
                                        # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_footprint_pred <- mod_footprint_pred$summary()
mod_diagnostics(mod_footprint_pred, sum_footprint_pred)
ppcheck_footprint_pred <- mod_footprint_pred$draws('ppcheck', format = 'matrix')

plot(density(dat$predation), main = '', 
     xlab = 'Seed predation', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_footprint_pred[i, ]), lwd = 0.1)
lines(density(dat$predation), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_footprint_pred')
```

### Posterior distributions

```{r}
post_footprint_pred <- 
  mod_footprint_pred$draws(c('alpha', 
                            # 'beta_lat', 
                            # 'beta_H_pop', 
                            'beta_H_foot',
                            # 'beta_I_mainland', 
                            # 'beta_I_footprint',
                            # 'beta_I_alt', 
                            #'beta_I_alt',
                            # 'beta_temp', 
                            # 'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_footprint_pred <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_footprint',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_footprint_pred[, grep(x, colnames(post_footprint_pred))]
           })

names(post_footprint_pred) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_footprint',
                               # 'beta_I_alt', 
                               # 'beta_I_footprint',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')

```



# S12. Effect of native vegetation

## Model: Total frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Total frugivory}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{human footprint}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{island altitude}_i + \beta \times \text{island isolation}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i + \zeta_{invasive~rank}\\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
& \zeta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_footprint_tot.rds`.

```{r, echo=FALSE}
mod_nativeV_tot <- readRDS('mod_nativeV_tot.rds')
mod_nativeV_tot$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_nativeV_total.stan')
fit_nativeV_tot <- cmdstan_model(file, compile = T)

mod_nativeV_tot <- 
  fit_nativeV_tot$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}
mcmc_trace(mod_nativeV_tot$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        #'beta_H_foot',
                                        'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome',
                           'eta', 'rho',
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        'beta_NV',
                                        # 'beta_bush', 
                                        # 'inv_rank', 
                                        )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_nativeV_tot <- mod_nativeV_tot$summary()
mod_diagnostics(mod_nativeV_tot, sum_nativeV_tot)
ppcheck_nativeV_tot <- mod_nativeV_tot$draws('ppcheck', format = 'matrix')

plot(density(dat$total_remotion), main = '', 
     xlab = 'Total fruigivory', ylim = c(0, 0.1))
for (i in 1:200) lines(density(ppcheck_nativeV_tot[i, ]), lwd = 0.1)
lines(density(dat$total_remotion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_nativeV_tot')
```

### Posterior distributions

```{r}
post_nativeV_tot <- 
  mod_nativeV_tot$draws(c('alpha', 
                            #'beta_lat', 
                            # 'beta_H_pop', 
                            # 'beta_H_foot',
                            # 'beta_I_mainland', 
                            #'beta_I_nativeV',
                            # 'beta_I_alt', 
                            #'beta_I_alt',
                            # 'beta_temp', 
                            'beta_NV',
                            # 'beta_bush', 
                            # 'inv_rank', 
                            'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome'), 
                          format = 'df')

post_nativeV_tot <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           #'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_nativeV',
           # 'beta_I_alt', 
           #'beta_I_alt',
           # 'beta_temp', 
           'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_nativeV_tot[, grep(x, colnames(post_nativeV_tot))]
           })

names(post_nativeV_tot) <- c('alpha', 
                               'beta', 
                               # 'beta_H_pop', 
                               # 'beta_H_foot',
                               # 'beta_I_mainland', 
                               # 'beta_I_nativeV',
                               # 'beta_I_alt', 
                               #'beta_I_nativeV',
                               # 'beta_temp', 
                               # 'beta_NV',
                               # 'beta_bush', 
                               # 'inv_rank', 
                               'TI', 'p_island', 
                               'p_country', 'p_grid', 
                               'p_plant', 'p_realm', 
                               'p_ecoR', 'p_biome')
```



## Model: Bird frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Bird frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{human footprint}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{island altitude}_i + \beta \times \text{island isolation}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i + \zeta_{invasive~rank}\\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
& \zeta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_nativeV_bird.rds`.

```{r, echo=FALSE}
mod_nativeV_bird <- readRDS('mod_nativeV_bird.rds')
mod_nativeV_bird$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_nativeV_bird.stan')
fit_nativeV_bird <- cmdstan_model(file, compile = T)

mod_nativeV_bird <- 
  fit_nativeV_bird$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_nativeV_bird$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        #'beta_H_foot',
                                      'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome',
                            'eta', 'rho',
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        'beta_NV',
                                        # 'beta_bush', 
                                        # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_nativeV_bird <- mod_nativeV_bird$summary()
mod_diagnostics(mod_nativeV_bird, sum_nativeV_bird)
ppcheck_nativeV_bird <- mod_nativeV_bird$draws('ppcheck', format = 'matrix')

plot(density(dat$Bird), main = '', 
     xlab = 'Bird frugivory', ylim = c(0, 3))
for (i in 1:200) lines(density(ppcheck_nativeV_bird[i, ]), lwd = 0.1)
lines(density(dat$Bird), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_nativeV_bird')
```

### Posterior distributions

```{r}
post_nativeV_bird <- 
  mod_nativeV_bird$draws(c('alpha', 
                           # 'beta_lat', 
                           # 'beta_H_pop', 
                           #'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_nativeV',
                           # 'beta_I_alt', 
                           # 'beta_I_alt',
                           # 'beta_temp', 
                           'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome'), 
                         format = 'df')

post_nativeV_bird <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_nativeV',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_nativeV_bird[, grep(x, colnames(post_nativeV_bird))]
           })

names(post_nativeV_bird) <- c('alpha', 
                              'beta', 
                              # 'beta_H_pop', 
                              # 'beta_H_foot',
                              # 'beta_I_mainland', 
                              # 'beta_I_nativeV',
                              # 'beta_I_alt', 
                              # 'beta_I_nativeV',
                              # 'beta_temp', 
                              # 'beta_NV',
                              # 'beta_bush', 
                              # 'inv_rank', 
                              'TI', 'p_island', 
                              'p_country', 'p_grid', 
                              'p_plant', 'p_realm', 
                              'p_ecoR', 'p_biome')

```


## Model: Lizard frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Lizard frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{human footprint}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{island altitude}_i + \beta \times \text{island isolation}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i + \zeta_{invasive~rank}\\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
& \zeta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_nativeV_lizard.rds`.

```{r, echo=FALSE}
mod_nativeV_lizard <- readRDS('mod_nativeV_lizard.rds')
mod_nativeV_lizard$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_footprint_lizard.stan')
fit_footprint_lizard <- cmdstan_model(file, compile = T)

mod_nativeV_lizard <- 
  fit_nativeV_lizard$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_nativeV_lizard$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        #'beta_H_foot',
                                        'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome',
                            'eta', 'rho',
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        'beta_NV',
                                        # 'beta_bush', 
                                        # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_nativeV_lizard <- mod_nativeV_lizard$summary()
mod_diagnostics(mod_nativeV_lizard, sum_nativeV_lizard)
ppcheck_nativeV_lizard <- mod_nativeV_lizard$draws('ppcheck', format = 'matrix')

plot(density(dat$Lizard), main = '', 
     xlab = 'Lizard frugivory', ylim = c(0, 6))
for (i in 1:200) lines(density(ppcheck_nativeV_lizard[i, ]), lwd = 0.1)
lines(density(dat$Lizard), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_nativeV_lizard')
```

### Posterior distributions

```{r}
post_nativeV_lizard <- 
  mod_nativeV_lizard$draws(c('alpha', 
                           # 'beta_lat', 
                           # 'beta_H_pop', 
                           #'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_nativeV',
                           # 'beta_I_alt', 
                           # 'beta_I_alt',
                           # 'beta_temp', 
                           'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome'), 
                         format = 'df')

post_nativeV_lizard <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_nativeV',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_nativeV_lizard[, grep(x, colnames(post_nativeV_lizard))]
           })

names(post_nativeV_lizard) <- c('alpha', 
                              'beta', 
                              # 'beta_H_pop', 
                              # 'beta_H_foot',
                              # 'beta_I_mainland', 
                              # 'beta_I_nativeV',
                              # 'beta_I_alt', 
                              # 'beta_I_nativeV',
                              # 'beta_temp', 
                              # 'beta_NV',
                              # 'beta_bush', 
                              # 'inv_rank', 
                              'TI', 'p_island', 
                              'p_country', 'p_grid', 
                              'p_plant', 'p_realm', 
                              'p_ecoR', 'p_biome')

```


## Model: Fruit dispersal

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit dispersal}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{human footprint}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{island altitude}_i + \beta \times \text{island isolation}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i + \zeta_{invasive~rank}\\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
& \zeta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_footprint_disp.rds`.

```{r, echo=FALSE}
mod_nativeV_disp <- readRDS('mod_nativeV_disp.rds')
mod_nativeV_disp$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_nativeV_dispersion.stan')
fit_nativeV_disp <- cmdstan_model(file, compile = T)

mod_nativeV_disp <- 
  fit_nativeV_disp$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_nativeV_disp$draws(c('alpha', 
                                     # 'beta_lat', 
                                     # 'beta_H_pop', 
                                      #'beta_H_foot',
                                     'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome',
                        'eta', 'rho',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_altitude',
                                     # 'beta_I_alt', 
                                     #'beta_I_alt'
                                     # 'beta_temp', 
                                     'beta_NV',
                                     # 'beta_bush', 
                                     # 'inv_rank', 
                                     )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_nativeV_disp <- mod_nativeV_disp$summary()
mod_diagnostics(mod_nativeV_disp, sum_nativeV_disp)
ppcheck_nativeV_disp <- mod_nativeV_disp$draws('ppcheck', format = 'matrix')

plot(density(dat$dispersion), main = '', 
     xlab = 'Fruit dispersal', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_nativeV_disp[i, ]), lwd = 0.1)
lines(density(dat$dispersion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_nativeV_disp')
```

### Posterior distributions

```{r}
post_nativeV_disp <- 
  mod_nativeV_disp$draws(c('alpha', 
                             # 'beta_lat', 
                             # 'beta_H_pop', 
                             #'beta_H_foot',
                             # 'beta_I_mainland', 
                             # 'beta_I_nativeV',
                             # 'beta_I_alt', 
                             # 'beta_I_alt',
                             # 'beta_temp', 
                             'beta_NV',
                             # 'beta_bush', 
                             # 'inv_rank', 
                             'TI', 'p_island', 
                             'p_country', 'p_grid', 
                             'p_plant', 'p_realm', 
                             'p_ecoR', 'p_biome'), 
                           format = 'df')

post_nativeV_disp <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_nativeV',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_nativeV_disp[, grep(x, colnames(post_nativeV_disp))]
           })

names(post_nativeV_disp) <- c('alpha', 
                                'beta', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_nativeV',
                                # 'beta_I_alt', 
                                # 'beta_I_nativeV',
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                'TI', 'p_island', 
                                'p_country', 'p_grid', 
                                'p_plant', 'p_realm', 
                                'p_ecoR', 'p_biome')

```


## Model: Fruit predation

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit predation}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{human footprint}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{island altitude}_i + \beta \times \text{island isolation}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i + \zeta_{invasive~rank}\\
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
& \zeta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_nativeV_pred.rds`.

```{r, echo=FALSE}
mod_nativeV_pred <- readRDS('mod_nativeV_pred.rds')
mod_nativeV_pred$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}

file <- paste0(getwd(), '/mod_nativeV_predation.stan')
fit_nativeV_pred <- cmdstan_model(file, compile = T)

mod_nativeV_pred <- 
  fit_nativeV_pred$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_nativeV_pred$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        #'beta_H_foot',
                                      'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome',
                        'eta', 'rho',
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        'beta_NV',
                                        # 'beta_bush', 
                                        # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_nativeV_pred <- mod_nativeV_pred$summary()
mod_diagnostics(mod_nativeV_pred, sum_nativeV_pred)
ppcheck_nativeV_pred <- mod_nativeV_pred$draws('ppcheck', format = 'matrix')

plot(density(dat$predation), main = '', 
     xlab = 'Seed predation', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_nativeV_pred[i, ]), lwd = 0.1)
lines(density(dat$predation), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_nativeV_pred')
```

### Posterior distributions

```{r}
post_nativeV_pred <- 
  mod_nativeV_pred$draws(c('alpha', 
                             # 'beta_lat', 
                             # 'beta_H_pop', 
                             # 'beta_H_foot',
                             # 'beta_I_mainland', 
                             # 'beta_I_nativeV',
                             # 'beta_I_alt', 
                             #'beta_I_alt',
                             # 'beta_temp', 
                             'beta_NV',
                             # 'beta_bush', 
                             # 'inv_rank', 
                             'TI', 'p_island', 
                             'p_country', 'p_grid', 
                             'p_plant', 'p_realm', 
                             'p_ecoR', 'p_biome'), 
                           format = 'df')

post_nativeV_pred <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_nativeV',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           'beta_NV',
           # 'beta_bush', 
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_nativeV_pred[, grep(x, colnames(post_nativeV_pred))]
           })

names(post_nativeV_pred) <- c('alpha', 
                                'beta', 
                                # 'beta_H_pop', 
                                # 'beta_H_foot',
                                # 'beta_I_mainland', 
                                # 'beta_I_nativeV',
                                # 'beta_I_alt', 
                                # 'beta_I_nativeV',
                                # 'beta_temp', 
                                # 'beta_NV',
                                # 'beta_bush', 
                                # 'inv_rank', 
                                'TI', 'p_island', 
                                'p_country', 'p_grid', 
                                'p_plant', 'p_realm', 
                                'p_ecoR', 'p_biome')

```



# S13. Effect of bush cover

## Model: Total frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Total frugivory}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{bush cover}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i +
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_bush_tot.rds`.

```{r, echo=FALSE}
mod_bush_tot <- readRDS('mod_bush_tot.rds')
mod_bush_tot$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_bush_total.stan')
fit_bush_tot <- cmdstan_model(file, compile = T)

mod_bush_tot <- 
  fit_bush_tot$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}
mcmc_trace(mod_bush_tot$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        #'beta_H_foot',
                                        'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome',
                           'eta', 'rho',
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        #'beta_NV',
                                         'beta_bush'
                                        # 'inv_rank', 
                                        )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_bush_tot <- mod_bush_tot$summary()
mod_diagnostics(mod_bush_tot, sum_bush_tot)
ppcheck_bush_tot <- mod_bush_tot$draws('ppcheck', format = 'matrix')

plot(density(dat$total_remotion), main = '', 
     xlab = 'Total fruigivory', ylim = c(0, 0.1))
for (i in 1:200) lines(density(ppcheck_bush_tot[i, ]), lwd = 0.1)
lines(density(dat$total_remotion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_bush_tot')
```

### Posterior distributions

```{r}
post_bush_tot <- 
  mod_bush_tot$draws(c('alpha', 
                          #'beta_lat', 
                          # 'beta_H_pop', 
                          # 'beta_H_foot',
                          # 'beta_I_mainland', 
                          #'beta_I_bush',
                          # 'beta_I_alt', 
                          #'beta_I_alt',
                          # 'beta_temp', 
                          # 'beta_NV',
                          'beta_bush',
                          # 'inv_rank', 
                          'TI', 'p_island', 
                          'p_country', 'p_grid', 
                          'p_plant', 'p_realm', 
                          'p_ecoR', 'p_biome'), 
                        format = 'df')

post_bush_tot <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           #'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_bush',
           # 'beta_I_alt', 
           #'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           'beta_bush',
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_bush_tot[, grep(x, colnames(post_bush_tot))]
           })

names(post_bush_tot) <- c('alpha', 
                             'beta', 
                             # 'beta_H_pop', 
                             # 'beta_H_foot',
                             # 'beta_I_mainland', 
                             # 'beta_I_bush',
                             # 'beta_I_alt', 
                             #'beta_I_bush',
                             # 'beta_temp', 
                             # 'beta_NV',
                             # 'beta_bush', 
                             # 'inv_rank', 
                             'TI', 'p_island', 
                             'p_country', 'p_grid', 
                             'p_plant', 'p_realm', 
                             'p_ecoR', 'p_biome')
```



## Model: Bird frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Bird frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{bush cover}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i +
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_bush_bird.rds`.

```{r, echo=FALSE}
mod_bush_bird <- readRDS('mod_bush_bird.rds')
mod_bush_bird$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_bush_bird.stan')
fit_bush_bird <- cmdstan_model(file, compile = T)

mod_bush_bird <- 
  fit_bush_bird$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )
```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_bush_bird$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        #'beta_H_foot',
                                      'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome',
                            'eta', 'rho',
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        #'beta_NV',
                                         'beta_bush' 
                                        # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_bush_bird <- mod_bush_bird$summary()
mod_diagnostics(mod_bush_bird, sum_bush_bird)
ppcheck_bush_bird <- mod_bush_bird$draws('ppcheck', format = 'matrix')

plot(density(dat$Bird), main = '', 
     xlab = 'Bird frugivory', ylim = c(0, 3))
for (i in 1:200) lines(density(ppcheck_bush_bird[i, ]), lwd = 0.1)
lines(density(dat$Bird), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_bush_bird')
```

### Posterior distributions

```{r}
post_bush_bird <- 
  mod_bush_bird$draws(c('alpha', 
                        # 'beta_lat', 
                        # 'beta_H_pop', 
                        #'beta_H_foot',
                        # 'beta_I_mainland', 
                        # 'beta_I_bush',
                        # 'beta_I_alt', 
                        # 'beta_I_alt',
                        # 'beta_temp', 
                        # 'beta_NV',
                        'beta_bush',
                        # 'inv_rank', 
                        'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome'), 
                      format = 'df')

post_bush_bird <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_bush',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           'beta_bush',
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_bush_bird[, grep(x, colnames(post_bush_bird))]
           })

names(post_bush_bird) <- c('alpha', 
                           'beta', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_bush',
                           # 'beta_I_alt', 
                           # 'beta_I_bush',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome')

```


## Model: Lizard frugivory

### Mathematical notation

$$
\begin{aligned}
& \text{Lizard frugivory}_{bush~i} \sim \text{bernoulli}(p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{bush cover}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i +
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_bush_lizard.rds`.

```{r, echo=FALSE}
mod_bush_lizard <- readRDS('mod_bush_lizard.rds')
mod_bush_lizard$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_bush_lizard.stan')
fit_bush_lizard <- cmdstan_model(file, compile = T)

mod_bush_lizard <- 
  fit_bush_lizard$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_bush_lizard$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        #'beta_H_foot',
                                        'TI', 'p_island', 
                            'p_country', 'p_grid', 
                            'p_plant', 'p_realm', 
                            'p_ecoR', 'p_biome',
                            'eta', 'rho',
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        #'beta_NV',
                                         'beta_bush'
                                        # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_bush_lizard <- mod_bush_lizard$summary()
mod_diagnostics(mod_bush_lizard, sum_bush_lizard)
ppcheck_bush_lizard <- mod_bush_lizard$draws('ppcheck', format = 'matrix')

plot(density(dat$Lizard), main = '', 
     xlab = 'Lizard frugivory', ylim = c(0, 6))
for (i in 1:200) lines(density(ppcheck_bush_lizard[i, ]), lwd = 0.1)
lines(density(dat$Lizard), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_bush_lizard')
```

### Posterior distributions

```{r}
post_bush_lizard <- 
  mod_bush_lizard$draws(c('alpha', 
                        # 'beta_lat', 
                        # 'beta_H_pop', 
                        #'beta_H_foot',
                        # 'beta_I_mainland', 
                        # 'beta_I_bush',
                        # 'beta_I_alt', 
                        # 'beta_I_alt',
                        # 'beta_temp', 
                        # 'beta_NV',
                        'beta_bush',
                        # 'inv_rank', 
                        'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome'), 
                      format = 'df')

post_bush_lizard <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_bush',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           'beta_bush',
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_bush_lizard[, grep(x, colnames(post_bush_lizard))]
           })

names(post_bush_lizard) <- c('alpha', 
                           'beta', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_bush',
                           # 'beta_I_alt', 
                           # 'beta_I_bush',
                           # 'beta_temp', 
                           # 'beta_NV',
                           # 'beta_bush', 
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome')

```


## Model: Fruit dispersal

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit dispersal}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{bush cover}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i +
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_bush_dip.rds`.

```{r, echo=FALSE}
mod_bush_disp <- readRDS('mod_bush_dip.rds')
mod_bush_disp$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}
file <- paste0(getwd(), '/mod_bush_dispersion.stan')
fit_bush_disp <- cmdstan_model(file, compile = T)

mod_bush_disp <- 
  fit_bush_disp$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_bush_disp$draws(c('alpha', 
                                     # 'beta_lat', 
                                     # 'beta_H_pop', 
                                      #'beta_H_foot',
                                     'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome',
                        'eta', 'rho',
                                     # 'beta_I_mainland', 
                                     # 'beta_I_altitude',
                                     # 'beta_I_alt', 
                                     #'beta_I_alt'
                                     # 'beta_temp', 
                                     #'beta_NV',
                                      'beta_bush'
                                     # 'inv_rank', 
                                     )))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_bush_disp <- mod_bush_disp$summary()
mod_diagnostics(mod_bush_disp, sum_bush_disp)
ppcheck_bush_disp <- mod_bush_disp$draws('ppcheck', format = 'matrix')

plot(density(dat$dispersion), main = '', 
     xlab = 'Fruit dispersal', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_bush_disp[i, ]), lwd = 0.1)
lines(density(dat$dispersion), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_bush_disp')
```

### Posterior distributions

```{r}
post_bush_disp <- 
  mod_bush_disp$draws(c('alpha', 
                           # 'beta_lat', 
                           # 'beta_H_pop', 
                           #'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_bush',
                           # 'beta_I_alt', 
                           # 'beta_I_alt',
                           # 'beta_temp', 
                           # 'beta_NV',
                           'beta_bush',
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome'), 
                         format = 'df')

post_bush_disp <- 
  lapply(c('alpha', 
           #'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_bush',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           'beta_bush',
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_bush_disp[, grep(x, colnames(post_bush_disp))]
           })

names(post_bush_disp) <- c('alpha', 
                              'beta', 
                              # 'beta_H_pop', 
                              # 'beta_H_foot',
                              # 'beta_I_mainland', 
                              # 'beta_I_bush',
                              # 'beta_I_alt', 
                              # 'beta_I_bush',
                              # 'beta_temp', 
                              # 'beta_NV',
                              # 'beta_bush', 
                              # 'inv_rank', 
                              'TI', 'p_island', 
                              'p_country', 'p_grid', 
                              'p_plant', 'p_realm', 
                              'p_ecoR', 'p_biome')

```


## Model: Fruit predation

### Mathematical notation

$$
\begin{aligned}
& \text{Fruit predation}_{bush~i} \sim \text{binomial}(15, p_i) \\
& logit(p) = \alpha + \beta \times \text{native vegetation}_i + \beta \times \text{bush cover}_i + \\
& ~~~~~~~~~~~~~~~~~~ \beta \times \text{temperature}_i +
& ~~~~~~~~~~~~~~~~~~ \theta_{plant~id} + \phi_{grid~id} + \tau_{island~id} + \psi_{country~id} +   \\
& ~~~~~~~~~~~~~~~~~~ \delta_{biome} + \gamma_{ecoregion} \\
\\
& \beta \sim \mathcal{N}(0, 1) \\
\end{aligned}
$$

### `Stan` code

Raw `stan` code of the model can be found at the file `mod_bush_pred.rds`.

```{r, echo=FALSE}
mod_bush_pred <- readRDS('mod_bush_pred.rds')
mod_bush_pred$code()
```

### MCMC Sampling setup

```{r, eval=FALSE}

file <- paste0(getwd(), '/mod_bush_predation.stan')
fit_bush_pred <- cmdstan_model(file, compile = T)

mod_bush_pred <- 
  fit_bush_pred$sample(
    data = dat, 
    chains = 4,
    parallel_chains = 4,
    iter_warmup = 500, 
    iter_sampling = 2e3,
    thin = 3, 
    seed = 23061993
  )

```


### MCMC diagnostics

```{r, fig.cap='Trace plots of main parameters. eta and rho are rate and length parameters of Gaussian processes', fig.height=15, fig.width=10}

mcmc_trace(mod_bush_pred$draws(c('alpha', 
                                        # 'beta_lat', 
                                        # 'beta_H_pop', 
                                        #'beta_H_foot',
                                      'TI', 'p_island', 
                        'p_country', 'p_grid', 
                        'p_plant', 'p_realm', 
                        'p_ecoR', 'p_biome',
                        'eta', 'rho',
                                        # 'beta_I_mainland', 
                                        # 'beta_I_footprint',
                                        # 'beta_I_alt', 
                                        # 'beta_I_alt',
                                        # 'beta_temp', 
                                        #'beta_NV',
                                         'beta_bush'
                                        # 'inv_rank', 
)))
```


```{r, fig.cap='left: Rhat and effective sampling size (ess) of the parameters. Right: Posterior predictive checks'}
par(mfrow = c(1, 2), mar = c(4, 4, 1, 1))
sum_bush_pred <- mod_bush_pred$summary()
mod_diagnostics(mod_bush_pred, sum_bush_pred)
ppcheck_bush_pred <- mod_bush_pred$draws('ppcheck', format = 'matrix')

plot(density(dat$predation), main = '', 
     xlab = 'Seed predation', ylim = c(0, 0.4))
for (i in 1:200) lines(density(ppcheck_bush_pred[i, ]), lwd = 0.1)
lines(density(dat$predation), lwd = 2, col = 'red')
par(mfrow = c(1, 1))

rm('ppcheck_bush_pred')
```

### Posterior distributions

```{r}
post_bush_pred <- 
  mod_bush_pred$draws(c('alpha', 
                           # 'beta_lat', 
                           # 'beta_H_pop', 
                           # 'beta_H_foot',
                           # 'beta_I_mainland', 
                           # 'beta_I_bush',
                           # 'beta_I_alt', 
                           #'beta_I_alt',
                           # 'beta_temp', 
                           # 'beta_NV',
                           'beta_bush',
                           # 'inv_rank', 
                           'TI', 'p_island', 
                           'p_country', 'p_grid', 
                           'p_plant', 'p_realm', 
                           'p_ecoR', 'p_biome'), 
                         format = 'df')

post_bush_pred <- 
  lapply(c('alpha', 
           # 'beta_lat', 
           # 'beta_H_pop', 
           # 'beta_H_foot',
           # 'beta_I_mainland', 
           # 'beta_I_bush',
           # 'beta_I_alt', 
           # 'beta_I_alt',
           # 'beta_temp', 
           # 'beta_NV',
           'beta_bush',
           # 'inv_rank', 
           'TI', 'p_island', 
           'p_country', 'p_grid', 
           'p_plant', 'p_realm', 
           'p_ecoR', 'p_biome'), FUN = 
           function(x) {
             post_bush_pred[, grep(x, colnames(post_bush_pred))]
           })

names(post_bush_pred) <- c('alpha', 
                              'beta', 
                              # 'beta_H_pop', 
                              # 'beta_H_foot',
                              # 'beta_I_mainland', 
                              # 'beta_I_bush',
                              # 'beta_I_alt', 
                              # 'beta_I_bush',
                              # 'beta_temp', 
                              # 'beta_NV',
                              # 'beta_bush', 
                              # 'inv_rank', 
                              'TI', 'p_island', 
                              'p_country', 'p_grid', 
                              'p_plant', 'p_realm', 
                              'p_ecoR', 'p_biome')

```










































































































































































# SXX. Results

# Factords

```{r, eval=FALSE}
est_latitude_tot <- cond_effects(posterior = post_latitude_tot,
                                 x_bar = dat$lat,
                                 slope = 'beta_lat',
                                 type = 'random',
                                 n = 100)

plot(dat$lat, dat$total_remotion, cex = 0.1)
est_latitude_tot %$% lines(x, y)
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)

est_latitude_tot <- cond_effects(posterior = post_latitude_tot,
                                 x_bar = dat$lat,
                                 slope = 'beta_lat',
                                 type = 'averaging',
                                 n = 100)

plot(NULL, xlim = c(-2.2, 1.8), ylim = c(0, 1))
est_latitude_tot %$% lines(x, y)
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)

est_latitude_tot <- cond_effects(posterior = post_altitude_tot,
                                 x_bar = dat$lat,
                                 slope = 'beta_lat',
                                 type = 'random',
                                 n = 100)

plot(dat$lat, dat$total_remotion, cex = 0.1)
est_latitude_tot %$% lines(x, y)
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)

est_latitude_tot %$% plot(x, y, type = 'l', ylim = c(0, 1))
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)


est_latitude_tot <- cond_effects(posterior = post_altitude_tot,
                                 x_bar = dat$lat,
                                 slope = 'beta_lat',
                                 type = 'averaging',
                                 n = 100)

plot(NULL, xlim = c(-2.2, 1.8), ylim = c(0, 1))
est_latitude_tot %$% lines(x, y)
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)


est_latitude_tot <- cond_effects(posterior = post_altitude_tot,
                                 x_bar = dat$lat,
                                 slope = 'beta_lat',
                                 type = 'random',
                                 n = 100)

plot(dat$lat, dat$total_remotion, cex = 0.1)
est_latitude_tot %$% lines(x, y)
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)

est_latitude_tot %$% plot(x, y, type = 'l', ylim = c(0, 1))
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)


est_latitude_tot <- cond_effects(posterior = post_altitude_tot,
                                 x_bar = dat$lat,
                                 slope = 'beta_lat',
                                 type = 'averaging',
                                 n = 100)

plot(NULL, xlim = c(-2.2, 1.8), ylim = c(0, 1))
est_latitude_tot %$% lines(x, y)
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)


est_latitude_tot <- cond_effects(posterior = post_altitude_tot,
                                 x_bar = dat$lat,
                                 slope = 'beta_lat',
                                 type = 'random',
                                 n = 100)

plot(dat$lat, dat$total_remotion, cex = 0.1)
est_latitude_tot %$% lines(x, y)
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)

est_latitude_tot %$% plot(x, y, type = 'l', ylim = c(0, 1))
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)


est_latitude_tot <- cond_effects(posterior = post_altitude_tot,
                                 x_bar = dat$lat,
                                 slope = 'beta_lat',
                                 type = 'averaging',
                                 n = 100)

plot(NULL, xlim = c(-2.2, 1.8), ylim = c(0, 1))
est_latitude_tot %$% lines(x, y)
est_latitude_tot %$% lines(x, li, lty = 3)
est_latitude_tot %$% lines(x, ls, lty = 3)

```

## Effect of type of island

```{r, eval=FALSE}
TI_tot <- average_effects(n_levels = ncol(post_latitude_tot$TI),
                          posterior = post_latitude_tot, 
                          x_var1 = 'island_type', 
                          x_var2 = 'realm', 
                          par1 = 'TI', 
                          par2 = 'p_realm')

TI_bird <- average_effects(n_levels = ncol(post_latitude_bird$TI),
                          posterior = post_latitude_bird, 
                          x_var1 = 'island_type', 
                          x_var2 = 'realm', 
                          par1 = 'TI', 
                          par2 = 'p_realm')

TI_lizard <- average_effects(n_levels = ncol(post_latitude_lizard$TI),
                          posterior = post_latitude_lizard, 
                          x_var1 = 'island_type', 
                          x_var2 = 'realm', 
                          par1 = 'TI', 
                          par2 = 'p_realm')

TI_disp <- average_effects(n_levels = ncol(post_latitude_disp$TI),
                           posterior = post_latitude_disp, 
                           x_var1 = 'island_type', 
                           x_var2 = 'realm', 
                           par1 = 'TI', 
                           par2 = 'p_realm')

TI_pred <- average_effects(n_levels = ncol(post_latitude_pred$TI),
                           posterior = post_latitude_pred, 
                           x_var1 = 'island_type', 
                           x_var2 = 'realm', 
                           par1 = 'TI', 
                           par2 = 'p_realm')
```


## Effect of realm

```{r, eval=FALSE}
realm_tot <- average_effects(n_levels = ncol(post_latitude_tot$p_realm),
                          posterior = post_latitude_tot, 
                          x_var1 = 'realm', 
                          x_var2 = 'island_type', 
                          par1 = 'p_realm', 
                          par2 = 'TI')

realm_disp <- average_effects(n_levels = ncol(post_latitude_disp$p_realm),
                           posterior = post_latitude_disp, 
                           x_var1 = 'realm', 
                           x_var2 = 'island_type', 
                           par1 = 'p_realm', 
                           par2 = 'TI')

realm_bird <- average_effects(n_levels = ncol(post_latitude_bird$p_realm),
                              posterior = post_latitude_bird, 
                              x_var1 = 'realm', 
                              x_var2 = 'island_type', 
                              par1 = 'p_realm', 
                              par2 = 'TI')

realm_lizard <- average_effects(n_levels = ncol(post_latitude_lizard$p_realm),
                              posterior = post_latitude_lizard, 
                              x_var1 = 'realm', 
                              x_var2 = 'island_type', 
                              par1 = 'p_realm', 
                              par2 = 'TI')

realm_pred <- average_effects(n_levels = ncol(post_latitude_pred$p_realm),
                           posterior = post_latitude_pred, 
                           x_var1 = 'realm', 
                           x_var2 = 'island_type', 
                           par1 = 'p_realm', 
                           par2 = 'TI')
```



















































